<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carteira de Vendas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(180deg, #F5F5F7 0%, #E5E5E7 100%);
            min-height: 100vh;
            padding: 20px;
            color: #1D1D1F;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(135deg, #007AFF 0%, #0051D5 100%);
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
        }

        h1 {
            color: white;
            font-size: 1.5em;
            font-weight: 600;
            text-align: center;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 
                0 1px 3px rgba(0, 0, 0, 0.08),
                0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .kpi-label {
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #86868B;
            margin-bottom: 8px;
        }

        .kpi-value {
            font-size: 1.5em;
            font-weight: 600;
            color: #1D1D1F;
        }

        .form-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 
                0 1px 3px rgba(0, 0, 0, 0.08),
                0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .form-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1D1D1F;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-size: 0.9em;
            font-weight: 500;
            color: #1D1D1F;
        }

        input {
            padding: 10px 12px;
            border: 1px solid #D1D1D6;
            border-radius: 8px;
            font-size: 0.95em;
            font-family: inherit;
            background: white;
            transition: all 0.2s;
        }

        input:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        input[type="number"] {
            max-width: 150px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #007AFF 0%, #0051D5 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(0, 122, 255, 0.4);
        }

        .btn-secondary {
            background: #E5E5E7;
            color: #1D1D1F;
        }

        .btn-secondary:hover {
            background: #D1D1D6;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .list-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 24px;
            border-radius: 12px;
            box-shadow: 
                0 1px 3px rgba(0, 0, 0, 0.08),
                0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .list-header {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1D1D1F;
        }

        .item {
            background: white;
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 12px;
            border: 1px solid #E5E5E7;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 16px;
            align-items: center;
        }

        .item-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .item-header {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .item-name {
            font-weight: 600;
            font-size: 0.95em;
            color: #1D1D1F;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .status-pending {
            background: #FFEBEE;
            color: #C62828;
        }

        .status-delivered {
            background: #E8F5E9;
            color: #2E7D32;
        }

        .item-values {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            font-size: 0.85em;
        }

        .value-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .value-label {
            color: #86868B;
            font-size: 0.9em;
        }

        .value-amount {
            font-weight: 600;
            color: #1D1D1F;
        }

        .btn-delete {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: #FF3B30;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-delete:hover {
            background: rgba(255, 59, 48, 0.1);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #86868B;
        }

        .export-buttons {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 12px;
        }

        .btn-float {
            width: 56px;
            height: 56px;
            border-radius: 28px;
            border: none;
            background: linear-gradient(135deg, #007AFF 0%, #0051D5 100%);
            color: white;
            font-size: 1.3em;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.4);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-float:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 122, 255, 0.5);
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .item {
                grid-template-columns: 1fr;
            }

            .export-buttons {
                flex-direction: column;
            }
        }

        @media print {
            body {
                background: white;
            }

            .form-card,
            .export-buttons,
            .btn-delete {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Carteira de Vendas</h1>
        </header>

        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-label">Total Vendido</div>
                <div class="kpi-value" id="totalVendido">R$ 0,00</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Total Entregue</div>
                <div class="kpi-value" id="totalEntregue">R$ 0,00</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Falta Entregar</div>
                <div class="kpi-value" id="faltaEntregar">R$ 0,00</div>
            </div>
        </div>

        <div class="form-card">
            <div class="form-title">Nova Venda</div>
            <form id="vendaForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Cliente</label>
                        <input type="text" id="cliente" required>
                    </div>
                    <div class="form-group">
                        <label>Produto</label>
                        <input type="text" id="produto" required>
                    </div>
                    <div class="form-group">
                        <label>Valor Total</label>
                        <input type="number" id="valorTotal" min="0" max="9999999" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Valor Entregue</label>
                        <input type="number" id="valorEntregue" min="0" max="9999999" step="0.01" value="0" required>
                    </div>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Adicionar Venda</button>
                    <button type="button" class="btn btn-secondary" onclick="limparFormulario()">Limpar</button>
                </div>
            </form>
        </div>

        <div class="list-card">
            <div class="list-header">Vendas Registradas</div>
            <div id="listaVendas"></div>
        </div>
    </div>

    <div class="export-buttons">
        <button class="btn-float" onclick="exportarPDF()" title="Exportar PDF">ðŸ“„</button>
        <button class="btn-float" onclick="exportarHTML()" title="Exportar HTML">ðŸ’¾</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // Verifica se estÃ¡ rodando versÃ£o exportada
        const isExported = window.__EXPORTED_DATA__ !== undefined;
        
        // FunÃ§Ãµes de gerenciamento de dados
        function carregarVendas() {
            if (isExported) {
                return window.__EXPORTED_DATA__;
            }
            const dados = localStorage.getItem('vendas');
            return dados ? JSON.parse(dados) : [];
        }

        function salvarVendas(vendas) {
            if (!isExported) {
                localStorage.setItem('vendas', JSON.stringify(vendas));
            }
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }

        function calcularStatus(valorTotal, valorEntregue) {
            return valorEntregue >= valorTotal ? 'delivered' : 'pending';
        }

        function atualizarKPIs() {
            const vendas = carregarVendas();
            const totalVendido = vendas.reduce((acc, v) => acc + parseFloat(v.valorTotal), 0);
            const totalEntregue = vendas.reduce((acc, v) => acc + parseFloat(v.valorEntregue), 0);
            const faltaEntregar = totalVendido - totalEntregue;

            document.getElementById('totalVendido').textContent = formatarMoeda(totalVendido);
            document.getElementById('totalEntregue').textContent = formatarMoeda(totalEntregue);
            document.getElementById('faltaEntregar').textContent = formatarMoeda(faltaEntregar);
        }

        function renderizarVendas() {
            const vendas = carregarVendas();
            const container = document.getElementById('listaVendas');

            if (vendas.length === 0) {
                container.innerHTML = '<div class="empty-state">Nenhuma venda registrada</div>';
                return;
            }

            container.innerHTML = vendas.map((venda, index) => {
                const status = calcularStatus(venda.valorTotal, venda.valorEntregue);
                const valorRestante = parseFloat(venda.valorTotal) - parseFloat(venda.valorEntregue);
                const statusText = status === 'delivered' ? 'Entregue' : 'A Entregar';
                const statusClass = status === 'delivered' ? 'status-delivered' : 'status-pending';

                return `
                    <div class="item">
                        <div class="item-info">
                            <div class="item-header">
                                <span class="item-name">${venda.cliente} - ${venda.produto}</span>
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                            <div class="item-values">
                                <div class="value-item">
                                    <span class="value-label">Total</span>
                                    <span class="value-amount">${formatarMoeda(venda.valorTotal)}</span>
                                </div>
                                <div class="value-item">
                                    <span class="value-label">Entregue</span>
                                    <span class="value-amount">${formatarMoeda(venda.valorEntregue)}</span>
                                </div>
                                <div class="value-item">
                                    <span class="value-label">Restante</span>
                                    <span class="value-amount">${formatarMoeda(valorRestante)}</span>
                                </div>
                            </div>
                        </div>
                        ${!isExported ? `<button class="btn-delete" onclick="excluirVenda(${index})" title="Excluir">Ã—</button>` : ''}
                    </div>
                `;
            }).join('');
        }

        function adicionarVenda(event) {
            event.preventDefault();

            const venda = {
                cliente: document.getElementById('cliente').value.trim(),
                produto: document.getElementById('produto').value.trim(),
                valorTotal: parseFloat(document.getElementById('valorTotal').value),
                valorEntregue: parseFloat(document.getElementById('valorEntregue').value)
            };

            const vendas = carregarVendas();
            vendas.push(venda);
            salvarVendas(vendas);

            limparFormulario();
            atualizarInterface();
        }

        function excluirVenda(index) {
            if (confirm('Deseja realmente excluir esta venda?')) {
                const vendas = carregarVendas();
                vendas.splice(index, 1);
                salvarVendas(vendas);
                atualizarInterface();
            }
        }

        function limparFormulario() {
            document.getElementById('vendaForm').reset();
            document.getElementById('valorEntregue').value = '0';
        }

        function atualizarInterface() {
            atualizarKPIs();
            renderizarVendas();
        }

        async function exportarPDF() {
            const { jsPDF } = window.jspdf;
            
            // Oculta botÃµes temporariamente
            const exportButtons = document.querySelector('.export-buttons');
            const formCard = document.querySelector('.form-card');
            exportButtons.style.display = 'none';
            formCard.style.display = 'none';

            try {
                const canvas = await html2canvas(document.body, {
                    scale: 2,
                    logging: false,
                    useCORS: true
                });

                const imgWidth = 210;
                const pageHeight = 297;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgData = canvas.toDataURL('image/png');
                
                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                pdf.save('carteira-vendas.pdf');
            } finally {
                exportButtons.style.display = 'flex';
                formCard.style.display = 'block';
            }
        }

        function exportarHTML() {
            const vendas = carregarVendas();
            const dataStr = JSON.stringify(vendas);
            
            const htmlTemplate = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carteira de Vendas - Exportado</title>
    <style>
        ${document.querySelector('style').textContent}
    </style>
</head>
<body>
    <script>
        window.__EXPORTED_DATA__ = ${dataStr};
    </script>
    ${document.body.innerHTML.replace(/<script[\s\S]*?<\/script>/gi, '')}
    <script>
        ${document.querySelector('script:not([src])').textContent}
        
        // Inicia interface com dados exportados
        document.addEventListener('DOMContentLoaded', () => {
            atualizarInterface();
        });
    </script>
</body>
</html>`;

            const blob = new Blob([htmlTemplate], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'carteira-vendas.html';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Event Listeners
        document.getElementById('vendaForm').addEventListener('submit', adicionarVenda);

        // InicializaÃ§Ã£o
        document.addEventListener('DOMContentLoaded', () => {
            atualizarInterface();
            
            // Oculta formulÃ¡rio se for versÃ£o exportada
            if (isExported) {
                document.querySelector('.form-card').style.display = 'none';
                document.querySelector('.export-buttons').style.display = 'none';
            }
        });
    </script>
</body>
</html>
